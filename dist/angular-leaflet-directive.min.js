/**!
 * The MIT License
 *
 * Copyright (c) 2013 the angular-leaflet-directive Team, http://tombatossals.github.io/angular-leaflet-directive
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * angular-leaflet-directive
 * https://github.com/tombatossals/angular-leaflet-directive
 *
 * @authors https://github.com/tombatossals/angular-leaflet-directive/graphs/contributors
 */

/*! angular-leaflet-directive 22-06-2014 */
!function(){"use strict";angular.module("leaflet-directive",[]).directive("leaflet",["$q","$rootScope","leafletData","leafletMapDefaults","leafletHelpers","leafletEvents",function(e,a,r,t,n,o){var l;return{restrict:"EA",replace:!0,scope:{center:"=center",defaults:"=defaults",maxbounds:"=maxbounds",bounds:"=bounds",markers:"=markers",legend:"=legend",geojson:"=geojson",paths:"=paths",tiles:"=tiles",layers:"=layers",controls:"=controls",decorations:"=decorations",eventBroadcast:"=eventBroadcast"},transclude:!0,template:'<div class="angular-leaflet-map"><div ng-transclude></div></div>',controller:["$scope",function(a){l=e.defer(),this.getMap=function(){return l.promise},this.getLeafletScope=function(){return a}}],link:function(e,i,s){var u=n.isDefined,c=t.setDefaults(e.defaults,s.id),d=o.genDispatchMapEvent,f=o.getAvailableMapEvents();u(s.width)&&(isNaN(s.width)?i.css("width",s.width):i.css("width",s.width+"px")),u(s.height)&&(isNaN(s.height)?i.css("height",s.height):i.css("height",s.height+"px"));var g=new L.Map(i[0],t.getMapCreationDefaults(s.id));if(l.resolve(g),u(s.center)||g.setView([c.center.lat,c.center.lng],c.center.zoom),!u(s.tiles)&&!u(s.layers)){var v=L.tileLayer(c.tileLayer,c.tileLayerOptions);v.addTo(g),r.setTiles(v,s.id)}if(u(g.zoomControl)&&u(c.zoomControlPosition)&&g.zoomControl.setPosition(c.zoomControlPosition),u(g.zoomControl)&&c.zoomControl===!1&&g.zoomControl.removeFrom(g),u(g.zoomsliderControl)&&u(c.zoomsliderControl)&&c.zoomsliderControl===!1&&g.zoomsliderControl.removeFrom(g),!u(s.eventBroadcast))for(var p="broadcast",m=0;m<f.length;m++){var y=f[m];g.on(y,d(e,y,p),{eventName:y})}g.whenReady(function(){r.setMap(g,s.id)}),a.$on("triggerLeafletResize",function(){g._onResize()}),e.$on("$destroy",function(){r.unresolveMap(s.id)})}}}]),angular.module("leaflet-directive").directive("center",["$log","$q","$location","leafletMapDefaults","leafletHelpers","leafletBoundsHelpers","leafletEvents",function(e,a,r,t,n,o,l){var i,s=n.isDefined,u=n.isNumber,c=n.isSameCenterOnMap,d=n.safeApply,f=n.isValidCenter,g=n.isEmpty,v=n.isUndefinedOrEmpty,p=function(e,a){return s(e)&&!g(e)&&v(a)};return{restrict:"A",scope:!1,replace:!1,require:"leaflet",controller:function(){i=a.defer(),this.getCenter=function(){return i.promise}},link:function(a,n,g,v){var m=v.getLeafletScope(),y=m.center;v.getMap().then(function(a){var n=t.getDefaults(g.id);if(-1!==g.center.search("-"))return e.error('The "center" variable can\'t use a "-" on his key name: "'+g.center+'".'),void a.setView([n.center.lat,n.center.lng],n.center.zoom);if(p(m.bounds,y))a.fitBounds(o.createLeafletBounds(m.bounds)),y=a.getCenter(),d(m,function(e){e.center={lat:a.getCenter().lat,lng:a.getCenter().lng,zoom:a.getZoom(),autoDiscover:!1}}),d(m,function(e){var r=a.getBounds(),t={northEast:{lat:r._northEast.lat,lng:r._northEast.lng},southWest:{lat:r._southWest.lat,lng:r._southWest.lng}};e.bounds=t});else{if(!s(y))return e.error('The "center" property is not defined in the main scope'),void a.setView([n.center.lat,n.center.lng],n.center.zoom);s(y.lat)&&s(y.lng)||s(y.autoDiscover)||angular.copy(n.center,y)}var v,L;if("yes"===g.urlHashCenter){var h=function(){var e,a=r.search();if(s(a.c)){var t=a.c.split(":");3===t.length&&(e={lat:parseFloat(t[0]),lng:parseFloat(t[1]),zoom:parseInt(t[2],10)})}return e};v=h(),m.$on("$locationChangeSuccess",function(e){var r=e.currentScope,t=h();s(t)&&!c(t,a)&&(r.center={lat:t.lat,lng:t.lng,zoom:t.zoom})})}m.$watch("center",function(r){return s(v)&&(angular.copy(v,r),v=void 0),f(r)||r.autoDiscover===!0?r.autoDiscover===!0?(u(r.zoom)||a.setView([n.center.lat,n.center.lng],n.center.zoom),void a.locate(u(r.zoom)&&r.zoom>n.center.zoom?{setView:!0,maxZoom:r.zoom}:s(n.maxZoom)?{setView:!0,maxZoom:n.maxZoom}:{setView:!0})):void(L&&c(r,a)||(a.setView([r.lat,r.lng],r.zoom),l.notifyCenterChangedToBounds(m,a))):void e.warn("[AngularJS - Leaflet] invalid 'center'")},!0),a.whenReady(function(){L=!0}),a.on("moveend",function(){i.resolve(),l.notifyCenterUrlHashChanged(m,a,g,r.search()),c(y,a)||d(m,function(e){e.center={lat:a.getCenter().lat,lng:a.getCenter().lng,zoom:a.getZoom(),autoDiscover:!1},l.notifyCenterChangedToBounds(m,a)})}),y.autoDiscover===!0&&a.on("locationerror",function(){e.warn("[AngularJS - Leaflet] The Geolocation API is unauthorized on this page."),f(y)?(a.setView([y.lat,y.lng],y.zoom),l.notifyCenterChangedToBounds(m,a)):(a.setView([n.center.lat,n.center.lng],n.center.zoom),l.notifyCenterChangedToBounds(m,a))})})}}}]),angular.module("leaflet-directive").directive("tiles",["$log","leafletData","leafletMapDefaults","leafletHelpers",function(e,a,r,t){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(n,o,l,i){var s=t.isDefined,u=i.getLeafletScope(),c=u.tiles;return s(c)||s(c.url)?void i.getMap().then(function(e){var t,n=r.getDefaults(l.id);u.$watch("tiles",function(r){var o=n.tileLayerOptions,i=n.tileLayer;return!s(r.url)&&s(t)?void e.removeLayer(t):s(t)?s(r.url)&&s(r.options)&&!angular.equals(r.options,o)?(e.removeLayer(t),o=n.tileLayerOptions,angular.copy(r.options,o),i=r.url,t=L.tileLayer(i,o),t.addTo(e),void a.setTiles(t,l.id)):void(s(r.url)&&t.setUrl(r.url)):(s(r.options)&&angular.copy(r.options,o),s(r.url)&&(i=r.url),t=L.tileLayer(i,o),t.addTo(e),void a.setTiles(t,l.id))},!0)}):void e.warn("[AngularJS - Leaflet] The 'tiles' definition doesn't have the 'url' property.")}}}]),angular.module("leaflet-directive").directive("legend",["$log","$http","leafletHelpers","leafletLegendHelpers",function(e,a,r,t){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(n,o,l,i){var s,u=r.isArray,c=r.isDefined,d=r.isFunction,f=i.getLeafletScope(),g=f.legend,v=g.legendClass?g.legendClass:"legend",p=g.position||"bottomright";i.getMap().then(function(r){f.$watch("legend",function(a){c(a.url)||u(a.colors)&&u(a.labels)&&a.colors.length===a.labels.length?c(a.url)?e.info("[AngularJS - Leaflet] loading arcgis legend service."):(s=L.control({position:p}),s.onAdd=t.getOnAddArrayLegend(a,v),s.addTo(r)):e.warn("[AngularJS - Leaflet] legend.colors and legend.labels must be set.")}),f.$watch("legend.url",function(n){c(n)&&a.get(n).success(function(e){c(s)?t.updateArcGISLegend(s.getContainer(),e):(s=L.control({position:p}),s.onAdd=t.getOnAddArcGISLegend(e,v),s.addTo(r)),c(g.loadedData)&&d(g.loadedData)&&g.loadedData()}).error(function(){e.warn("[AngularJS - Leaflet] legend.url not loaded.")})})})}}}]),angular.module("leaflet-directive").directive("geojson",["$log","$rootScope","leafletData","leafletHelpers",function(e,a,r,t){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(e,n,o,l){var i=t.safeApply,s=t.isDefined,u=l.getLeafletScope(),c={};l.getMap().then(function(e){u.$watch("geojson",function(n){if(s(c)&&e.hasLayer(c)&&e.removeLayer(c),s(n)&&s(n.data)){var o=n.resetStyleOnMouseout,l=n.onEachFeature;l||(l=function(e,r){t.LabelPlugin.isLoaded()&&s(n.label)&&r.bindLabel(e.properties.description),r.on({mouseover:function(r){i(u,function(){n.selected=e,a.$broadcast("leafletDirectiveMap.geojsonMouseover",r)})},mouseout:function(e){o&&c.resetStyle(e.target),i(u,function(){n.selected=void 0,a.$broadcast("leafletDirectiveMap.geojsonMouseout",e)})},click:function(r){i(u,function(){n.selected=e,a.$broadcast("leafletDirectiveMap.geojsonClick",n.selected,r)})}})}),n.options={style:n.style,filter:n.filter,onEachFeature:l,pointToLayer:n.pointToLayer},c=L.geoJson(n.data,n.options),r.setGeoJSON(c),c.addTo(e)}})})}}}]),angular.module("leaflet-directive").directive("layers",["$log","$q","leafletData","leafletHelpers","leafletLayerHelpers","leafletControlHelpers",function(e,a,r,t,n,o){var l;return{restrict:"A",scope:!1,replace:!1,require:"leaflet",controller:function(){l=a.defer(),this.getLayers=function(){return l.promise}},link:function(a,i,s,u){var c=t.isDefined,d={},f=u.getLeafletScope(),g=f.layers,v=n.createLayer,p=o.updateLayersControl,m=!1;u.getMap().then(function(a){if(!c(g)||!c(g.baselayers)||0===Object.keys(g.baselayers).length)return void e.error("[AngularJS - Leaflet] At least one baselayer has to be defined");l.resolve(d),r.setLayers(d,s.id),d.baselayers={},d.overlays={};var t=s.id,n=!1;for(var o in g.baselayers){var i=v(g.baselayers[o]);c(i)?(d.baselayers[o]=i,g.baselayers[o].top===!0&&(a.addLayer(d.baselayers[o]),n=!0)):delete g.baselayers[o]}!n&&Object.keys(d.baselayers).length>0&&a.addLayer(d.baselayers[Object.keys(g.baselayers)[0]]);for(o in g.overlays){var u=v(g.overlays[o]);c(u)?(d.overlays[o]=u,g.overlays[o].visible===!0&&a.addLayer(d.overlays[o])):delete g.overlays[o]}f.$watch("layers.baselayers",function(r){for(var n in d.baselayers)c(r[n])||(a.hasLayer(d.baselayers[n])&&a.removeLayer(d.baselayers[n]),delete d.baselayers[n]);for(var o in r)if(!c(d.baselayers[o])){var l=v(r[o]);c(l)&&(d.baselayers[o]=l,r[o].top===!0&&a.addLayer(d.baselayers[o]))}if(0===Object.keys(d.baselayers).length)return void e.error("[AngularJS - Leaflet] At least one baselayer has to be defined");var i=!1;for(var s in d.baselayers)if(a.hasLayer(d.baselayers[s])){i=!0;break}i||a.addLayer(d.baselayers[Object.keys(g.baselayers)[0]]),m=p(a,t,m,r,g.overlays,d)},!0),f.$watch("layers.overlays",function(e){for(var r in d.overlays)c(e[r])||(a.hasLayer(d.overlays[r])&&a.removeLayer(d.overlays[r]),delete d.overlays[r]);for(var n in e){if(!c(d.overlays[n])){var o=v(e[n]);c(o)&&(d.overlays[n]=o,e[n].visible===!0&&a.addLayer(d.overlays[n]))}e[n].visible&&!a.hasLayer(d.overlays[n])?a.addLayer(d.overlays[n]):e[n].visible===!1&&a.hasLayer(d.overlays[n])&&a.removeLayer(d.overlays[n])}m=p(a,t,m,g.baselayers,e,d)},!0)})}}}]),angular.module("leaflet-directive").directive("bounds",["$log","$timeout","leafletHelpers","leafletBoundsHelpers",function(e,a,r,t){return{restrict:"A",scope:!1,replace:!1,require:["leaflet","center"],link:function(a,n,o,l){var i=r.isDefined,s=t.createLeafletBounds,u=l[0].getLeafletScope(),c=l[0],d=function(e){return 0===e._southWest.lat&&0===e._southWest.lng&&0===e._northEast.lat&&0===e._northEast.lng?!0:!1};c.getMap().then(function(a){u.$on("boundsChanged",function(e){var r=e.currentScope,t=a.getBounds();if(!d(t)){var n={northEast:{lat:t._northEast.lat,lng:t._northEast.lng},southWest:{lat:t._southWest.lat,lng:t._southWest.lng}};angular.equals(r.bounds,n)||(r.bounds=n)}}),u.$watch("bounds",function(r){if(!i(r))return void e.error("[AngularJS - Leaflet] Invalid bounds");var t=s(r);t&&!a.getBounds().equals(t)&&a.fitBounds(t)},!0)})}}}]),angular.module("leaflet-directive").directive("markers",["$log","$rootScope","$q","leafletData","leafletHelpers","leafletMapDefaults","leafletMarkersHelpers","leafletEvents",function(e,a,r,t,n,o,l,i){return{restrict:"A",scope:!1,replace:!1,require:["leaflet","?layers"],link:function(a,o,s,u){var c=u[0],d=n,f=n.isDefined,g=n.isString,v=c.getLeafletScope(),p=l.deleteMarker,m=l.addMarkerWatcher,y=l.listenMarkerEvents,h=l.addMarkerToGroup,b=i.bindMarkerEvents,A=l.createMarker;c.getMap().then(function(a){var n,o={};n=f(u[1])?u[1].getLayers:function(){var e=r.defer();return e.resolve(),e.promise},n().then(function(r){t.setMarkers(o,s.id),v.$watch("markers",function(t){for(var n in o)f(t)&&f(t[n])||(p(o[n],a,r),delete o[n]);for(var l in t)if(-1===l.search("-")){if(!f(o[l])){var i=t[l],u=A(i);if(!f(u)){e.error("[AngularJS - Leaflet] Received invalid data on the marker "+l+".");continue}if(o[l]=u,f(i.message)&&u.bindPopup(i.message,i.popupOptions),f(i.group)&&h(u,i.group,a),d.LabelPlugin.isLoaded()&&f(i.label)&&f(i.label.message)&&u.bindLabel(i.label.message,i.label.options),f(i)&&f(i.layer)){if(!g(i.layer)){e.error("[AngularJS - Leaflet] A layername must be a string");continue}if(!f(r)){e.error("[AngularJS - Leaflet] You must add layers to the directive if the markers are going to use this functionality.");continue}if(!f(r.overlays)||!f(r.overlays[i.layer])){e.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group"');continue}var c=r.overlays[i.layer];if(!(c instanceof L.LayerGroup||c instanceof L.FeatureGroup)){e.error('[AngularJS - Leaflet] Adding a marker to an overlay needs a overlay of the type "group" or "featureGroup"');continue}c.addLayer(u),a.hasLayer(u)&&i.focus===!0&&u.openPopup()}else f(i.group)||(a.addLayer(u),i.focus===!0&&u.openPopup(),d.LabelPlugin.isLoaded()&&f(i.label)&&f(i.label.options)&&i.label.options.noHide===!0&&u.showLabel());var k=!f(s.watchMarkers)||"true"===s.watchMarkers;k&&(m(u,l,v,r,a),y(u,i,v)),b(u,l,i,v)}}else e.error('The marker can\'t use a "-" on his key name: "'+l+'".')},!0)})})}}}]),angular.module("leaflet-directive").directive("paths",["$log","$q","leafletData","leafletMapDefaults","leafletHelpers","leafletPathsHelpers","leafletEvents",function(e,a,r,t,n,o,l){return{restrict:"A",scope:!1,replace:!1,require:["leaflet","?layers"],link:function(i,s,u,c){var d=c[0],f=n.isDefined,g=n.isString,v=d.getLeafletScope(),p=v.paths,m=o.createPath,y=l.bindPathEvents,h=o.setPathOptions;d.getMap().then(function(o){var l,i=t.getDefaults(u.id);l=f(c[1])?c[1].getLayers:function(){var e=a.defer();return e.resolve(),e.promise},f(p)&&l().then(function(a){var t={};r.setPaths(t,u.id);var l=function(e,a){var r=v.$watch("paths."+a,function(a){return f(a)?void h(e,a.type,a):(o.removeLayer(e),void r())},!0)};v.$watch("paths",function(r){for(var s in r)if(0!==s.search("\\$"))if(-1===s.search("-")){if(!f(t[s])){var u=r[s],c=m(s,r[s],i);if(f(c)&&f(u.message)&&c.bindPopup(u.message),n.LabelPlugin.isLoaded()&&f(u.label)&&f(u.label.message)&&c.bindLabel(u.label.message,u.label.options),f(u)&&f(u.layer)){if(!g(u.layer)){e.error("[AngularJS - Leaflet] A layername must be a string");continue}if(!f(a)){e.error("[AngularJS - Leaflet] You must add layers to the directive if the markers are going to use this functionality.");continue}if(!f(a.overlays)||!f(a.overlays[u.layer])){e.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group"');continue}var d=a.overlays[u.layer];if(!(d instanceof L.LayerGroup||d instanceof L.FeatureGroup)){e.error('[AngularJS - Leaflet] Adding a marker to an overlay needs a overlay of the type "group" or "featureGroup"');continue}t[s]=c,d.addLayer(c),l(c,s)}else f(c)&&(t[s]=c,o.addLayer(c),l(c,s));y(c,s,u,v)}}else e.error('[AngularJS - Leaflet] The path name "'+s+'" is not valid. It must not include "-" and a number.');for(var p in t)f(r[p])||delete t[p]})},!0)})}}}]),angular.module("leaflet-directive").directive("controls",["$log","leafletHelpers",function(e,a){return{restrict:"A",scope:!1,replace:!1,require:"?^leaflet",link:function(e,r,t,n){if(n){var o=a.isDefined,l=n.getLeafletScope(),i=l.controls;n.getMap().then(function(e){if(o(L.Control.Draw)&&o(i.draw)){var a=new L.FeatureGroup;e.addLayer(a);var r={edit:{featureGroup:a}};angular.extend(r,i.draw.options);var t=new L.Control.Draw(r);e.addControl(t)}if(o(i.custom))for(var n in i.custom)e.addControl(i.custom[n])})}}}}]),angular.module("leaflet-directive").directive("eventBroadcast",["$log","$rootScope","leafletHelpers","leafletEvents",function(e,a,r,t){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(a,n,o,l){var i=r.isObject,s=l.getLeafletScope(),u=s.eventBroadcast,c=t.getAvailableMapEvents(),d=t.genDispatchMapEvent;l.getMap().then(function(a){var r,t,n=[],o="broadcast";if(i(u)){if(void 0===u.map||null===u.map)n=c;else if("object"!=typeof u.map)e.warn("[AngularJS - Leaflet] event-broadcast.map must be an object check your model.");else{void 0!==u.map.logic&&null!==u.map.logic&&("emit"!==u.map.logic&&"broadcast"!==u.map.logic?e.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===u.map.logic&&(o="emit"));var l=!1,f=!1;if(void 0!==u.map.enable&&null!==u.map.enable&&"object"==typeof u.map.enable&&(l=!0),void 0!==u.map.disable&&null!==u.map.disable&&"object"==typeof u.map.disable&&(f=!0),l&&f)e.warn("[AngularJS - Leaflet] can not enable and disable events at the time");else if(l||f)if(l)for(r=0;r<u.map.enable.length;r++)t=u.map.enable[r],-1!==n.indexOf(t)?e.warn("[AngularJS - Leaflet] This event "+t+" is already enabled"):-1===c.indexOf(t)?e.warn("[AngularJS - Leaflet] This event "+t+" does not exist"):n.push(t);else for(n=c,r=0;r<u.map.disable.length;r++){t=u.map.disable[r];var g=n.indexOf(t);-1===g?e.warn("[AngularJS - Leaflet] This event "+t+" does not exist or has been already disabled"):n.splice(g,1)}else e.warn("[AngularJS - Leaflet] must enable or disable events")}for(r=0;r<n.length;r++)t=n[r],a.on(t,d(s,t,o),{eventName:t})}else e.warn("[AngularJS - Leaflet] event-broadcast must be an object, check your model.")})}}}]),angular.module("leaflet-directive").directive("maxbounds",["$log","leafletMapDefaults","leafletBoundsHelpers",function(e,a,r){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(e,a,t,n){var o=n.getLeafletScope(),l=r.isValidBounds;n.getMap().then(function(e){o.$watch("maxbounds",function(a){if(!l(a))return void e.setMaxBounds();var r=[[a.southWest.lat,a.southWest.lng],[a.northEast.lat,a.northEast.lng]];e.setMaxBounds(r),e.fitBounds(r)})})}}}]),angular.module("leaflet-directive").directive("decorations",["$log","leafletHelpers",function(e,a){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(r,t,n,o){function l(a){return c(a)&&c(a.coordinates)&&(u.isLoaded()||e.error("[AngularJS - Leaflet] The PolylineDecorator Plugin is not loaded.")),L.polylineDecorator(a.coordinates)}function i(e,a){return c(e)&&c(a)&&c(a.coordinates)&&c(a.patterns)?(e.setPaths(a.coordinates),e.setPatterns(a.patterns),e):void 0}var s=o.getLeafletScope(),u=a.PolylineDecoratorPlugin,c=a.isDefined,d={};o.getMap().then(function(e){s.$watch("decorations",function(a){for(var r in d)c(a)&&c(a[r])||delete d[r],e.removeLayer(d[r]);for(var t in a){var n=a[t],o=l(n);c(o)&&(d[t]=o,e.addLayer(o),i(o,n))}},!0)})}}}]),angular.module("leaflet-directive").service("leafletData",["$log","$q","leafletHelpers",function(e,a,r){var t=r.getDefer,n=r.getUnresolvedDefer,o=r.setResolvedDefer,l={},i={},s={},u={},c={},d={},f={};this.setMap=function(e,a){var r=n(l,a);r.resolve(e),o(l,a)},this.getMap=function(e){var a=t(l,e);return a.promise},this.unresolveMap=function(e){var a=r.obtainEffectiveMapId(l,e);l[a]=void 0},this.getPaths=function(e){var a=t(u,e);return a.promise},this.setPaths=function(e,a){var r=n(u,a);r.resolve(e),o(u,a)},this.getMarkers=function(e){var a=t(c,e);return a.promise},this.setMarkers=function(e,a){var r=n(c,a);r.resolve(e),o(c,a)},this.getLayers=function(e){var a=t(s,e);return a.promise},this.setLayers=function(e,a){var r=n(s,a);r.resolve(e),o(s,a)},this.setTiles=function(e,a){var r=n(i,a);r.resolve(e),o(i,a)},this.getTiles=function(e){var a=t(i,e);return a.promise},this.setGeoJSON=function(e,a){var r=n(d,a);r.resolve(e),o(d,a)},this.getGeoJSON=function(e){var a=t(d,e);return a.promise},this.setDecorations=function(e,a){var r=n(f,a);r.resolve(e),o(f,a)},this.getDecorations=function(e){var a=t(f,e);return a.promise}}]),angular.module("leaflet-directive").factory("leafletMapDefaults",["$q","leafletHelpers",function(e,a){function r(){return{keyboard:!0,dragging:!0,worldCopyJump:!1,doubleClickZoom:!0,scrollWheelZoom:!0,zoomControl:!0,zoomsliderControl:!1,zoomControlPosition:"topleft",attributionControl:!0,controls:{layers:{visible:!0,position:"topright",collapsed:!0}},crs:L.CRS.EPSG3857,tileLayer:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",tileLayerOptions:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},path:{weight:10,opacity:1,color:"#0000ff"},center:{lat:0,lng:0,zoom:1}}}var t=a.isDefined,n=a.isObject,o=a.obtainEffectiveMapId,l={};return{getDefaults:function(e){var a=o(l,e);return l[a]},getMapCreationDefaults:function(e){var a=o(l,e),r=l[a],n={maxZoom:r.maxZoom,keyboard:r.keyboard,dragging:r.dragging,zoomControl:r.zoomControl,doubleClickZoom:r.doubleClickZoom,scrollWheelZoom:r.scrollWheelZoom,attributionControl:r.attributionControl,worldCopyJump:r.worldCopyJump,crs:r.crs};if(t(r.minZoom)&&(n.minZoom=r.minZoom),t(r.zoomAnimation)&&(n.zoomAnimation=r.zoomAnimation),t(r.fadeAnimation)&&(n.fadeAnimation=r.fadeAnimation),t(r.markerZoomAnimation)&&(n.markerZoomAnimation=r.markerZoomAnimation),r.map)for(var i in r.map)n[i]=r.map[i];return n},setDefaults:function(e,a){var i=r();t(e)&&(i.doubleClickZoom=t(e.doubleClickZoom)?e.doubleClickZoom:i.doubleClickZoom,i.scrollWheelZoom=t(e.scrollWheelZoom)?e.scrollWheelZoom:i.doubleClickZoom,i.zoomControl=t(e.zoomControl)?e.zoomControl:i.zoomControl,i.zoomsliderControl=t(e.zoomsliderControl)?e.zoomsliderControl:i.zoomsliderControl,i.attributionControl=t(e.attributionControl)?e.attributionControl:i.attributionControl,i.tileLayer=t(e.tileLayer)?e.tileLayer:i.tileLayer,i.zoomControlPosition=t(e.zoomControlPosition)?e.zoomControlPosition:i.zoomControlPosition,i.keyboard=t(e.keyboard)?e.keyboard:i.keyboard,i.dragging=t(e.dragging)?e.dragging:i.dragging,t(e.controls)&&angular.extend(i.controls,e.controls),n(e.crs)?i.crs=e.crs:t(L.CRS[e.crs])&&(i.crs=L.CRS[e.crs]),t(e.tileLayerOptions)&&angular.copy(e.tileLayerOptions,i.tileLayerOptions),t(e.maxZoom)&&(i.maxZoom=e.maxZoom),t(e.minZoom)&&(i.minZoom=e.minZoom),t(e.zoomAnimation)&&(i.zoomAnimation=e.zoomAnimation),t(e.fadeAnimation)&&(i.fadeAnimation=e.fadeAnimation),t(e.markerZoomAnimation)&&(i.markerZoomAnimation=e.markerZoomAnimation),t(e.worldCopyJump)&&(i.worldCopyJump=e.worldCopyJump),t(e.map)&&(i.map=e.map));var s=o(l,a);return l[s]=i,i}}}]),angular.module("leaflet-directive").factory("leafletEvents",["$rootScope","$q","$log","leafletHelpers",function(e,a,r,t){var n=t.safeApply,o=t.isDefined,l=t.isObject,i=t,s=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu"]},u=function(e,a,r,t){for(var n=s(),o="markers."+t,l=0;l<n.length;l++){var i=n[l];r.label.on(i,f(e,i,a,r.label,o))}},c=function(a,r,t,o,l,i){return function(s){var u="leafletDirectiveMarker."+a;"click"===a?n(t,function(){e.$broadcast("leafletDirectiveMarkersClick",l)}):"dragend"===a&&(n(t,function(){i.lat=o.getLatLng().lat,i.lng=o.getLatLng().lng}),i.message&&i.focus===!0&&o.openPopup()),n(t,function(a){"emit"===r?a.$emit(u,{markerName:l,leafletEvent:s}):e.$broadcast(u,{markerName:l,leafletEvent:s})})}},d=function(a,r,t,o,l){return function(o){var i="leafletDirectivePath."+a;n(t,function(a){"emit"===r?a.$emit(i,{pathName:l,leafletEvent:o}):e.$broadcast(i,{pathName:l,leafletEvent:o})})}},f=function(a,r,t,o,l){return function(i){var s="leafletDirectiveLabel."+r,u=l.replace("markers.","");n(a,function(a){"emit"===t?a.$emit(s,{leafletEvent:i,label:o,markerName:u}):"broadcast"===t&&e.$broadcast(s,{leafletEvent:i,label:o,markerName:u})})}},g=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu","dragstart","drag","dragend","move","remove","popupopen","popupclose"]},v=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu","add","remove","popupopen","popupclose"]};return{getAvailableMapEvents:function(){return["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","contextmenu","focus","blur","preclick","load","unload","viewreset","movestart","move","moveend","dragstart","drag","dragend","zoomstart","zoomend","zoomlevelschange","resize","autopanstart","layeradd","layerremove","baselayerchange","overlayadd","overlayremove","locationfound","locationerror","popupopen","popupclose","draw:created","draw:edited","draw:deleted","draw:drawstart","draw:drawstop","draw:editstart","draw:editstop","draw:deletestart","draw:deletestop"]},genDispatchMapEvent:function(a,r,t){return function(o){var l="leafletDirectiveMap."+r;n(a,function(a){"emit"===t?a.$emit(l,{leafletEvent:o}):"broadcast"===t&&e.$broadcast(l,{leafletEvent:o})})}},getAvailableMarkerEvents:g,getAvailablePathEvents:v,notifyCenterChangedToBounds:function(e){e.$broadcast("boundsChanged")},notifyCenterUrlHashChanged:function(e,a,r,t){if(o(r.urlHashCenter)){var n=a.getCenter(),l=n.lat.toFixed(4)+":"+n.lng.toFixed(4)+":"+a.getZoom();o(t.c)&&t.c===l||e.$emit("centerUrlHash",l)}},bindMarkerEvents:function(e,a,t,n){var s,d,f=[],v="broadcast";if(o(n.eventBroadcast))if(l(n.eventBroadcast))if(o(n.eventBroadcast.marker))if(l(n.eventBroadcast.marker)){void 0!==n.eventBroadcast.marker.logic&&null!==n.eventBroadcast.marker.logic&&("emit"!==n.eventBroadcast.marker.logic&&"broadcast"!==n.eventBroadcast.marker.logic?r.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===n.eventBroadcast.marker.logic&&(v="emit"));var p=!1,m=!1;if(void 0!==n.eventBroadcast.marker.enable&&null!==n.eventBroadcast.marker.enable&&"object"==typeof n.eventBroadcast.marker.enable&&(p=!0),void 0!==n.eventBroadcast.marker.disable&&null!==n.eventBroadcast.marker.disable&&"object"==typeof n.eventBroadcast.marker.disable&&(m=!0),p&&m)r.warn("[AngularJS - Leaflet] can not enable and disable events at the same time");else if(p||m)if(p)for(s=0;s<n.eventBroadcast.marker.enable.length;s++)d=n.eventBroadcast.marker.enable[s],-1!==f.indexOf(d)?r.warn("[AngularJS - Leaflet] This event "+d+" is already enabled"):-1===g().indexOf(d)?r.warn("[AngularJS - Leaflet] This event "+d+" does not exist"):f.push(d);else for(f=g(),s=0;s<n.eventBroadcast.marker.disable.length;s++){d=n.eventBroadcast.marker.disable[s];var y=f.indexOf(d);-1===y?r.warn("[AngularJS - Leaflet] This event "+d+" does not exist or has been already disabled"):f.splice(y,1)}else r.warn("[AngularJS - Leaflet] must enable or disable events")}else r.warn("[AngularJS - Leaflet] event-broadcast.marker must be an object check your model.");else f=g();else r.error("[AngularJS - Leaflet] event-broadcast must be an object check your model.");else f=g();for(s=0;s<f.length;s++)d=f[s],e.on(d,c(d,v,n,e,a,t));i.LabelPlugin.isLoaded()&&o(e.label)&&u(n,v,e,a)},bindPathEvents:function(e,a,t,n){var s,c,f=[],g="broadcast";if(window.lls=n,o(n.eventBroadcast))if(l(n.eventBroadcast))if(o(n.eventBroadcast.path))if(l(n.eventBroadcast.paths))r.warn("[AngularJS - Leaflet] event-broadcast.path must be an object check your model.");else{void 0!==n.eventBroadcast.path.logic&&null!==n.eventBroadcast.path.logic&&("emit"!==n.eventBroadcast.path.logic&&"broadcast"!==n.eventBroadcast.path.logic?r.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===n.eventBroadcast.path.logic&&(g="emit"));var p=!1,m=!1;if(void 0!==n.eventBroadcast.path.enable&&null!==n.eventBroadcast.path.enable&&"object"==typeof n.eventBroadcast.path.enable&&(p=!0),void 0!==n.eventBroadcast.path.disable&&null!==n.eventBroadcast.path.disable&&"object"==typeof n.eventBroadcast.path.disable&&(m=!0),p&&m)r.warn("[AngularJS - Leaflet] can not enable and disable events at the same time");else if(p||m)if(p)for(s=0;s<n.eventBroadcast.path.enable.length;s++)c=n.eventBroadcast.path.enable[s],-1!==f.indexOf(c)?r.warn("[AngularJS - Leaflet] This event "+c+" is already enabled"):-1===v().indexOf(c)?r.warn("[AngularJS - Leaflet] This event "+c+" does not exist"):f.push(c);else for(f=v(),s=0;s<n.eventBroadcast.path.disable.length;s++){c=n.eventBroadcast.path.disable[s];var y=f.indexOf(c);-1===y?r.warn("[AngularJS - Leaflet] This event "+c+" does not exist or has been already disabled"):f.splice(y,1)}else r.warn("[AngularJS - Leaflet] must enable or disable events")}else f=v();else r.error("[AngularJS - Leaflet] event-broadcast must be an object check your model.");else f=v();for(s=0;s<f.length;s++)c=f[s],e.on(c,d(c,g,n,f,a));i.LabelPlugin.isLoaded()&&o(e.label)&&u(n,g,e,a)}}}]),angular.module("leaflet-directive").factory("leafletLayerHelpers",["$rootScope","$log","leafletHelpers",function($rootScope,$log,leafletHelpers){function isValidLayerType(e){return isString(e.type)?-1===Object.keys(layerTypes).indexOf(e.type)?($log.error("[AngularJS - Leaflet] A layer must have a valid type: "+Object.keys(layerTypes)),!1):layerTypes[e.type].mustHaveUrl&&!isString(e.url)?($log.error("[AngularJS - Leaflet] A base layer must have an url"),!1):layerTypes[e.type].mustHaveData&&!isDefined(e.data)?($log.error('[AngularJS - Leaflet] The base layer must have a "data" array attribute'),!1):layerTypes[e.type].mustHaveLayer&&!isDefined(e.layer)?($log.error("[AngularJS - Leaflet] The type of layer "+e.type+" must have an layer defined"),!1):layerTypes[e.type].mustHaveBounds&&!isDefined(e.bounds)?($log.error("[AngularJS - Leaflet] The type of layer "+e.type+" must have bounds defined"),!1):!0:!1}var Helpers=leafletHelpers,isString=leafletHelpers.isString,isObject=leafletHelpers.isObject,isDefined=leafletHelpers.isDefined,layerTypes={xyz:{mustHaveUrl:!0,createLayer:function(e){return L.tileLayer(e.url,e.options)}},geoJSON:{mustHaveUrl:!0,createLayer:function(e){return Helpers.GeoJSONPlugin.isLoaded()?new L.TileLayer.GeoJSON(e.url,e.pluginOptions,e.options):void 0}},wms:{mustHaveUrl:!0,createLayer:function(e){return L.tileLayer.wms(e.url,e.options)}},wmts:{mustHaveUrl:!0,createLayer:function(e){return L.tileLayer.wmts(e.url,e.options)}},wfs:{mustHaveUrl:!0,mustHaveLayer:!0,createLayer:function(params){if(Helpers.WFSLayerPlugin.isLoaded()){var options=angular.copy(params.options);return options.crs&&"string"==typeof options.crs&&(options.crs=eval(options.crs)),new L.GeoJSON.WFS(params.url,params.layer,options)}}},group:{mustHaveUrl:!1,createLayer:function(){return L.layerGroup()}},featureGroup:{mustHaveUrl:!1,createLayer:function(){return L.featureGroup()}},google:{mustHaveUrl:!1,createLayer:function(e){var a=e.type||"SATELLITE";if(Helpers.GoogleLayerPlugin.isLoaded())return new L.Google(a,e.options)}},china:{mustHaveUrl:!1,createLayer:function(e){var a=e.type||"";if(Helpers.ChinaLayerPlugin.isLoaded())return L.tileLayer.chinaProvider(a,e.options)}},ags:{mustHaveUrl:!0,createLayer:function(e){if(Helpers.AGSLayerPlugin.isLoaded()){var a=angular.copy(e.options);angular.extend(a,{url:e.url});var r=new lvector.AGS(a);return r.onAdd=function(e){this.setMap(e)},r.onRemove=function(){this.setMap(null)},r}}},dynamic:{mustHaveUrl:!0,createLayer:function(e){return Helpers.DynamicMapLayerPlugin.isLoaded()?L.esri.dynamicMapLayer(e.url,e.options):void 0}},markercluster:{mustHaveUrl:!1,createLayer:function(e){return Helpers.MarkerClusterPlugin.isLoaded()?new L.MarkerClusterGroup(e.options):void $log.error("[AngularJS - Leaflet] The markercluster plugin is not loaded.")}},bing:{mustHaveUrl:!1,createLayer:function(e){return Helpers.BingLayerPlugin.isLoaded()?new L.BingLayer(e.key,e.options):void 0}},heatmap:{mustHaveUrl:!1,mustHaveData:!0,createLayer:function(e){if(Helpers.HeatMapLayerPlugin.isLoaded()){var a=new L.TileLayer.WebGLHeatMap(e.options);return isDefined(e.data)&&a.setData(e.data),a}}},yandex:{mustHaveUrl:!1,createLayer:function(e){var a=e.type||"map";if(Helpers.YandexLayerPlugin.isLoaded())return new L.Yandex(a,e.options)}},imageOverlay:{mustHaveUrl:!0,mustHaveBounds:!0,createLayer:function(e){return L.imageOverlay(e.url,e.bounds,e.options)}}};return{createLayer:function(e){if(isValidLayerType(e)){if(!isString(e.name))return void $log.error("[AngularJS - Leaflet] A base layer must have a name");isObject(e.layerParams)||(e.layerParams={}),isObject(e.layerOptions)||(e.layerOptions={});for(var a in e.layerParams)e.layerOptions[a]=e.layerParams[a];var r={url:e.url,data:e.data,options:e.layerOptions,layer:e.layer,type:e.layerType,bounds:e.bounds,key:e.key,pluginOptions:e.pluginOptions};return layerTypes[e.type].createLayer(r)}}}}]),angular.module("leaflet-directive").factory("leafletControlHelpers",["$rootScope","$log","leafletHelpers","leafletMapDefaults",function(e,a,r,t){var n,o=r.isObject,l=r.isDefined,i=function(e,a){var r=0;return o(e)&&(r+=Object.keys(e).length),o(a)&&(r+=Object.keys(a).length),r>1},s=function(e){var a,r=t.getDefaults(e),n={collapsed:r.controls.layers.collapsed,position:r.controls.layers.position};return a=r.controls.layers&&l(r.controls.layers.control)?r.controls.layers.control.apply(this,[[],[],n]):new L.control.layers([],[],n)};return{layersControlMustBeVisible:i,updateLayersControl:function(e,a,r,t,o,u){var c,d=i(t,o);
if(l(n)&&r){for(c in u.baselayers)n.removeLayer(u.baselayers[c]);for(c in u.overlays)n.removeLayer(u.overlays[c]);n.removeFrom(e)}if(d){n=s(a);for(c in t)l(u.baselayers[c])&&n.addBaseLayer(u.baselayers[c],t[c].name);for(c in o)l(u.overlays[c])&&n.addOverlay(u.overlays[c],o[c].name);n.addTo(e)}return d}}}]),angular.module("leaflet-directive").factory("leafletLegendHelpers",function(){var e=function(e,a){if(e.innerHTML="",a.error)e.innerHTML+='<div class="info-title alert alert-danger">'+a.error.message+"</div>";else for(var r=0;r<a.layers.length;r++){var t=a.layers[r];e.innerHTML+='<div class="info-title">'+t.layerName+"</div>";for(var n=0;n<t.legend.length;n++){var o=t.legend[n];e.innerHTML+='<div class="inline"><img src="data:'+o.contentType+";base64,"+o.imageData+'" /></div><div class="info-label">'+o.label+"</div>"}}},a=function(a,r){return function(){var t=L.DomUtil.create("div",r);return L.Browser.touch?L.DomEvent.on(t,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(t),L.DomEvent.on(t,"mousewheel",L.DomEvent.stopPropagation)),e(t,a),t}},r=function(e,a){return function(){for(var r=L.DomUtil.create("div",a),t=0;t<e.colors.length;t++)r.innerHTML+='<div class="outline"><i style="background:'+e.colors[t]+'"></i></div><div class="info-label">'+e.labels[t]+"</div>";return L.Browser.touch?L.DomEvent.on(r,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(r),L.DomEvent.on(r,"mousewheel",L.DomEvent.stopPropagation)),r}};return{getOnAddArcGISLegend:a,getOnAddArrayLegend:r,updateArcGISLegend:e}}),angular.module("leaflet-directive").factory("leafletPathsHelpers",["$rootScope","$log","leafletHelpers",function(e,a,r){function t(e){return e.filter(function(e){return c(e)}).map(function(e){return new L.LatLng(e.lat,e.lng)})}function n(e){return new L.LatLng(e.lat,e.lng)}function o(e){return e.map(function(e){return t(e)})}function l(e,a){for(var r={},t=0;t<d.length;t++){var n=d[t];i(e[n])?r[n]=e[n]:i(a.path[n])&&(r[n]=a.path[n])}return r}var i=r.isDefined,s=r.isArray,u=r.isNumber,c=r.isValidPoint,d=["stroke","weight","color","opacity","fill","fillColor","fillOpacity","dashArray","lineCap","lineJoin","clickable","pointerEvents","className","smoothFactor","noClip"],f=function(e,a){for(var r={},t=0;t<d.length;t++){var n=d[t];i(a[n])&&(r[n]=a[n])}e.setStyle(a)},g=function(e){if(!s(e))return!1;for(var a in e){var r=e[a];if(!c(r))return!1}return!0},v={polyline:{isValid:function(e){var a=e.latlngs;return g(a)},createPath:function(e){return new L.Polyline([],e)},setPath:function(e,a){e.setLatLngs(t(a.latlngs)),f(e,a)}},multiPolyline:{isValid:function(e){var a=e.latlngs;if(!s(a))return!1;for(var r in a){var t=a[r];if(!g(t))return!1}return!0},createPath:function(e){return new L.multiPolyline([[[0,0],[1,1]]],e)},setPath:function(e,a){e.setLatLngs(o(a.latlngs)),f(e,a)}},polygon:{isValid:function(e){var a=e.latlngs;return g(a)},createPath:function(e){return new L.Polygon([],e)},setPath:function(e,a){e.setLatLngs(t(a.latlngs)),f(e,a)}},multiPolygon:{isValid:function(e){var a=e.latlngs;if(!s(a))return!1;for(var r in a){var t=a[r];if(!g(t))return!1}return!0},createPath:function(e){return new L.MultiPolygon([[[0,0],[1,1],[0,1]]],e)},setPath:function(e,a){e.setLatLngs(o(a.latlngs)),f(e,a)}},rectangle:{isValid:function(e){var a=e.latlngs;if(!s(a)||2!==a.length)return!1;for(var r in a){var t=a[r];if(!c(t))return!1}return!0},createPath:function(e){return new L.Rectangle([[0,0],[1,1]],e)},setPath:function(e,a){e.setBounds(new L.LatLngBounds(t(a.latlngs))),f(e,a)}},circle:{isValid:function(e){var a=e.latlngs;return c(a)&&u(e.radius)},createPath:function(e){return new L.Circle([0,0],1,e)},setPath:function(e,a){e.setLatLng(n(a.latlngs)),i(a.radius)&&e.setRadius(a.radius),f(e,a)}},circleMarker:{isValid:function(e){var a=e.latlngs;return c(a)&&u(e.radius)},createPath:function(e){return new L.CircleMarker([0,0],e)},setPath:function(e,a){e.setLatLng(n(a.latlngs)),i(a.radius)&&e.setRadius(a.radius),f(e,a)}}},p=function(e){var a={};return e.latlngs&&(a.latlngs=e.latlngs),e.radius&&(a.radius=e.radius),a};return{setPathOptions:function(e,a,r){i(a)||(a="polyline"),v[a].setPath(e,r)},createPath:function(e,r,t){i(r.type)||(r.type="polyline");var n=l(r,t),o=p(r);return v[r.type].isValid(o)?v[r.type].createPath(n):void a.error("[AngularJS - Leaflet] Invalid data passed to the "+r.type+" path")}}}]),angular.module("leaflet-directive").factory("leafletBoundsHelpers",["$log","leafletHelpers",function(e,a){function r(e){return angular.isDefined(e)&&angular.isDefined(e.southWest)&&angular.isDefined(e.northEast)&&angular.isNumber(e.southWest.lat)&&angular.isNumber(e.southWest.lng)&&angular.isNumber(e.northEast.lat)&&angular.isNumber(e.northEast.lng)}var t=a.isArray,n=a.isNumber;return{createLeafletBounds:function(e){return r(e)?L.latLngBounds([e.southWest.lat,e.southWest.lng],[e.northEast.lat,e.northEast.lng]):void 0},isValidBounds:r,createBoundsFromArray:function(a){return t(a)&&2===a.length&&t(a[0])&&t(a[1])&&2===a[0].length&&2===a[1].length&&n(a[0][0])&&n(a[0][1])&&n(a[1][0])&&n(a[1][1])?{northEast:{lat:a[0][0],lng:a[0][1]},southWest:{lat:a[1][0],lng:a[1][1]}}:void e.error("[AngularJS - Leaflet] The bounds array is not valid.")}}}]),angular.module("leaflet-directive").factory("leafletMarkersHelpers",["$rootScope","leafletHelpers","$log",function(e,a,r){var t=a.isDefined,n=a.MarkerClusterPlugin,o=a.AwesomeMarkersPlugin,l=a.MakiMarkersPlugin,i=a.ExtraMarkersPlugin,s=a.safeApply,u=a,c=a.isString,d=a.isNumber,f=a.isObject,g={},v=function(e){if(t(e)&&t(e.type)&&"awesomeMarker"===e.type)return o.isLoaded()||r.error("[AngularJS - Leaflet] The AwesomeMarkers Plugin is not loaded."),new L.AwesomeMarkers.icon(e);if(t(e)&&t(e.type)&&"makiMarker"===e.type)return l.isLoaded()||r.error("[AngularJS - Leaflet] The MakiMarkers Plugin is not loaded."),new L.MakiMarkers.icon(e);if(t(e)&&t(e.type)&&"ExtraMarker"===e.type)return i.isLoaded()||r.error("[AngularJS - Leaflet] The ExtraMarkers Plugin is not loaded."),new L.ExtraMarkers.icon(e);if(t(e)&&t(e.type)&&"div"===e.type)return new L.divIcon(e);var a="data:image/png;base64,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",n="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAYAAACoYAD2AAAC5ElEQVRYw+2YW4/TMBCF45S0S1luXZCABy5CgLQgwf//S4BYBLTdJLax0fFqmB07nnQfEGqkIydpVH85M+NLjPe++dcPc4Q8Qh4hj5D/AaQJx6H/4TMwB0PeBNwU7EGQAmAtsNfAzoZkgIa0ZgLMa4Aj6CxIAsjhjOCoL5z7Glg1JAOkaicgvQBXuncwJAWjksLtBTWZe04CnYRktUGdilALppZBOgHGZcBzL6OClABvMSVIzyBjazOgrvACf1ydC5mguqAVg6RhdkSWQFj2uxfaq/BrIZOLEWgZdALIDvcMcZLD8ZbLC9de4yR1sYMi4G20S4Q/PWeJYxTOZn5zJXANZHIxAd4JWhPIloTJZhzMQduM89WQ3MUVAE/RnhAXpTycqys3NZALOBbB7kFrgLesQl2h45Fcj8L1tTSohUwuxhy8H/Qg6K7gIs+3kkaigQCOcyEXCHN07wyQazhrmIulvKMQAwMcmLNqyCVyMAI+BuxSMeTk3OPikLY2J1uE+VHQk6ANrhds+tNARqBeaGc72cK550FP4WhXmFmcMGhTwAR1ifOe3EvPqIegFmF+C8gVy0OfAaWQPMR7gF1OQKqGoBjq90HPMP01BUjPOqGFksC4emE48tWQAH0YmvOgF3DST6xieJgHAWxPAHMuNhrImIdvoNOKNWIOcE+UXE0pYAnkX6uhWsgVXDxHdTfCmrEEmMB2zMFimLVOtiiajxiGWrbU52EeCdyOwPEQD8LqyPH9Ti2kgYMf4OhSKB7qYILbBv3CuVTJ11Y80oaseiMWOONc/Y7kJYe0xL2f0BaiFTxknHO5HaMGMublKwxFGzYdWsBF174H/QDknhTHmHHN39iWFnkZx8lPyM8WHfYELmlLKtgWNmFNzQcC1b47gJ4hL19i7o65dhH0Negbca8vONZoP7doIeOC9zXm8RjuL0Gf4d4OYaU5ljo3GYiqzrWQHfJxA6ALhDpVKv9qYeZA8eM3EhfPSCmpuD0AAAAASUVORK5CYII=";return t(e)?(t(e.iconUrl)||(e.iconUrl=a,e.shadowUrl=n),new L.Icon.Default(e)):new L.Icon.Default({iconUrl:a,shadowUrl:n})},p=function(e,a,r){if(e.closePopup(),t(r)&&t(r.overlays))for(var n in r.overlays)if((r.overlays[n]instanceof L.LayerGroup||r.overlays[n]instanceof L.FeatureGroup)&&r.overlays[n].hasLayer(e))return void r.overlays[n].removeLayer(e);if(t(g))for(var o in g)g[o].hasLayer(e)&&g[o].removeLayer(e);a.hasLayer(e)&&a.removeLayer(e)};return{deleteMarker:p,createMarker:function(e){if(!t(e))return void r.error("[AngularJS - Leaflet] The marker definition is not valid.");var a={icon:v(e.icon),title:t(e.title)?e.title:"",draggable:t(e.draggable)?e.draggable:!1,clickable:t(e.clickable)?e.clickable:!0,riseOnHover:t(e.riseOnHover)?e.riseOnHover:!1,zIndexOffset:t(e.zIndexOffset)?e.zIndexOffset:0,iconAngle:t(e.iconAngle)?e.iconAngle:0};for(var n in e)e.hasOwnProperty(n)&&!a.hasOwnProperty(n)&&(a[n]=e[n]);return new L.marker(e,a)},addMarkerToGroup:function(e,a,o){return c(a)?n.isLoaded()?(t(g[a])||(g[a]=new L.MarkerClusterGroup,o.addLayer(g[a])),void g[a].addLayer(e)):void r.error("[AngularJS - Leaflet] The MarkerCluster plugin is not loaded."):void r.error("[AngularJS - Leaflet] The marker group you have specified is invalid.")},listenMarkerEvents:function(e,a,r){e.on("popupopen",function(){s(r,function(){a.focus=!0})}),e.on("popupclose",function(){s(r,function(){a.focus=!1})})},addMarkerWatcher:function(e,a,n,o,l){var i=n.$watch("markers."+a,function(a,n){if(!t(a))return p(e,l,o),void i();if(t(n)){if(!d(a.lat)||!d(a.lng))return r.warn("There are problems with lat-lng data, please verify your marker model"),void p(e,l,o);if(c(a.layer)||c(n.layer)&&(t(o.overlays[n.layer])&&o.overlays[n.layer].hasLayer(e)&&(o.overlays[n.layer].removeLayer(e),e.closePopup()),l.hasLayer(e)||l.addLayer(e)),c(a.layer)&&n.layer!==a.layer){if(c(n.layer)&&t(o.overlays[n.layer])&&o.overlays[n.layer].hasLayer(e)&&o.overlays[n.layer].removeLayer(e),e.closePopup(),l.hasLayer(e)&&l.removeLayer(e),!t(o.overlays[a.layer]))return void r.error("[AngularJS - Leaflet] You must use a name of an existing layer");var s=o.overlays[a.layer];if(!(s instanceof L.LayerGroup||s instanceof L.FeatureGroup))return void r.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group" or "featureGroup"');s.addLayer(e),l.hasLayer(e)&&a.focus===!0&&e.openPopup()}if(a.draggable!==!0&&n.draggable===!0&&t(e.dragging)&&e.dragging.disable(),a.draggable===!0&&n.draggable!==!0&&(e.dragging?e.dragging.enable():L.Handler.MarkerDrag&&(e.dragging=new L.Handler.MarkerDrag(e),e.options.draggable=!0,e.dragging.enable())),f(a.icon)||f(n.icon)&&(e.setIcon(v()),e.closePopup(),e.unbindPopup(),c(a.message)&&e.bindPopup(a.message)),f(a.icon)&&f(n.icon)&&!angular.equals(a.icon,n.icon)){var g=!1;e.dragging&&(g=e.dragging.enabled()),e.setIcon(v(a.icon)),g&&e.dragging.enable(),e.closePopup(),e.unbindPopup(),c(a.message)&&e.bindPopup(a.message)}!c(a.message)&&c(n.message)&&(e.closePopup(),e.unbindPopup()),u.LabelPlugin.isLoaded()&&t(a.label)&&t(a.label.message)&&!angular.equals(a.label.message,n.label.message)&&e.updateLabelContent(a.label.message),c(a.message)&&!c(n.message)&&(e.bindPopup(a.message),a.focus===!0&&e.openPopup()),c(a.message)&&c(n.message)&&a.message!==n.message&&e.setPopupContent(a.message);var m=!1;a.focus!==!0&&n.focus===!0&&(e.closePopup(),m=!0),a.focus===!0&&n.focus!==!0&&(e.openPopup(),m=!0),n.focus===!0&&a.focus===!0&&(e.openPopup(),m=!0);var y=e.getLatLng(),h=c(a.layer)&&u.MarkerClusterPlugin.is(o.overlays[a.layer]);h?m?(a.lat!==n.lat||a.lng!==n.lng)&&(o.overlays[a.layer].removeLayer(e),e.setLatLng([a.lat,a.lng]),o.overlays[a.layer].addLayer(e)):y.lat!==a.lat||y.lng!==a.lng?(o.overlays[a.layer].removeLayer(e),e.setLatLng([a.lat,a.lng]),o.overlays[a.layer].addLayer(e)):(a.lat!==n.lat||a.lng!==n.lng)&&(o.overlays[a.layer].removeLayer(e),e.setLatLng([a.lat,a.lng]),o.overlays[a.layer].addLayer(e)):(y.lat!==a.lat||y.lng!==a.lng)&&e.setLatLng([a.lat,a.lng])}},!0)}}}]),angular.module("leaflet-directive").factory("leafletHelpers",["$q","$log",function(e,a){function r(e,r){var t,n;if(angular.isDefined(r))t=r;else if(1===Object.keys(e).length)for(n in e)e.hasOwnProperty(n)&&(t=n);else 0===Object.keys(e).length?t="main":a.error("[AngularJS - Leaflet] - You have more than 1 map on the DOM, you must provide the map ID to the leafletData.getXXX call");return t}function t(a,t){var n,o=r(a,t);return angular.isDefined(a[o])&&a[o].resolvedDefer!==!0?n=a[o].defer:(n=e.defer(),a[o]={defer:n,resolvedDefer:!1}),n}return{isEmpty:function(e){return 0===Object.keys(e).length},isUndefinedOrEmpty:function(e){return angular.isUndefined(e)||null===e||0===Object.keys(e).length},isDefined:function(e){return angular.isDefined(e)&&null!==e},isNumber:function(e){return angular.isNumber(e)},isString:function(e){return angular.isString(e)},isArray:function(e){return angular.isArray(e)},isObject:function(e){return angular.isObject(e)},isFunction:function(e){return angular.isFunction(e)},equals:function(e,a){return angular.equals(e,a)},isValidCenter:function(e){return angular.isDefined(e)&&angular.isNumber(e.lat)&&angular.isNumber(e.lng)&&angular.isNumber(e.zoom)},isValidPoint:function(e){return angular.isDefined(e)&&angular.isNumber(e.lat)&&angular.isNumber(e.lng)},isSameCenterOnMap:function(e,a){var r=a.getCenter(),t=a.getZoom();return r.lat===e.lat&&r.lng===e.lng&&t===e.zoom?!0:!1},safeApply:function(e,a){var r=e.$root.$$phase;"$apply"===r||"$digest"===r?e.$eval(a):e.$apply(a)},obtainEffectiveMapId:r,getDefer:function(e,a){var n,o=r(e,a);return n=angular.isDefined(e[o])&&e[o].resolvedDefer!==!1?e[o].defer:t(e,a)},getUnresolvedDefer:t,setResolvedDefer:function(e,a){var t=r(e,a);e[t].resolvedDefer=!0},AwesomeMarkersPlugin:{isLoaded:function(){return angular.isDefined(L.AwesomeMarkers)&&angular.isDefined(L.AwesomeMarkers.Icon)?!0:!1},is:function(e){return this.isLoaded()?e instanceof L.AwesomeMarkers.Icon:!1},equal:function(e,a){return this.isLoaded()&&this.is(e)?angular.equals(e,a):!1}},PolylineDecoratorPlugin:{isLoaded:function(){return angular.isDefined(L.PolylineDecorator)?!0:!1},is:function(e){return this.isLoaded()?e instanceof L.PolylineDecorator:!1},equal:function(e,a){return this.isLoaded()&&this.is(e)?angular.equals(e,a):!1}},MakiMarkersPlugin:{isLoaded:function(){return angular.isDefined(L.MakiMarkers)&&angular.isDefined(L.MakiMarkers.Icon)?!0:!1},is:function(e){return this.isLoaded()?e instanceof L.MakiMarkers.Icon:!1},equal:function(e,a){return this.isLoaded()&&this.is(e)?angular.equals(e,a):!1}},ExtraMarkersPlugin:{isLoaded:function(){return angular.isDefined(L.ExtraMarkers)&&angular.isDefined(L.ExtraMarkers.Icon)?!0:!1},is:function(e){return this.isLoaded()?e instanceof L.ExtraMarkers.Icon:!1},equal:function(e,a){return this.isLoaded()&&this.is(e)?angular.equals(e,a):!1}},LabelPlugin:{isLoaded:function(){return angular.isDefined(L.Label)},is:function(e){return this.isLoaded()?e instanceof L.MarkerClusterGroup:!1}},MarkerClusterPlugin:{isLoaded:function(){return angular.isDefined(L.MarkerClusterGroup)},is:function(e){return this.isLoaded()?e instanceof L.MarkerClusterGroup:!1}},GoogleLayerPlugin:{isLoaded:function(){return angular.isDefined(L.Google)},is:function(e){return this.isLoaded()?e instanceof L.Google:!1}},ChinaLayerPlugin:{isLoaded:function(){return angular.isDefined(L.tileLayer.chinaProvider)}},HeatMapLayerPlugin:{isLoaded:function(){return angular.isDefined(L.TileLayer.WebGLHeatMap)}},BingLayerPlugin:{isLoaded:function(){return angular.isDefined(L.BingLayer)},is:function(e){return this.isLoaded()?e instanceof L.BingLayer:!1}},WFSLayerPlugin:{isLoaded:function(){return void 0!==L.GeoJSON.WFS},is:function(e){return this.isLoaded()?e instanceof L.GeoJSON.WFS:!1}},AGSLayerPlugin:{isLoaded:function(){return void 0!==lvector&&void 0!==lvector.AGS},is:function(e){return this.isLoaded()?e instanceof lvector.AGS:!1}},YandexLayerPlugin:{isLoaded:function(){return angular.isDefined(L.Yandex)},is:function(e){return this.isLoaded()?e instanceof L.Yandex:!1}},DynamicMapLayerPlugin:{isLoaded:function(){return void 0!==L.esri&&void 0!==L.esri.dynamicMapLayer},is:function(e){return this.isLoaded()?e instanceof L.esri.dynamicMapLayer:!1}},GeoJSONPlugin:{isLoaded:function(){return angular.isDefined(L.TileLayer.GeoJSON)},is:function(e){return this.isLoaded()?e instanceof L.TileLayer.GeoJSON:!1}},Leaflet:{DivIcon:{is:function(e){return e instanceof L.DivIcon},equal:function(e,a){return this.is(e)?angular.equals(e,a):!1}},Icon:{is:function(e){return e instanceof L.Icon},equal:function(e,a){return this.is(e)?angular.equals(e,a):!1}}}}}])}();